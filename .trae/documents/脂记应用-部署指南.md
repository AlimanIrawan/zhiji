# è„‚è®°åº”ç”¨ - å®Œæ•´éƒ¨ç½²æŒ‡å—

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

è„‚è®°æ˜¯ä¸€ä¸ªåŸºäº Next.js 14 çš„æ™ºèƒ½é¥®é£Ÿè¿½è¸ªåº”ç”¨ï¼Œé›†æˆäº† AI é£Ÿç‰©åˆ†æå’Œ Garmin è¿åŠ¨æ•°æ®åŒæ­¥åŠŸèƒ½ã€‚

### æŠ€æœ¯æ ˆ
- **å‰ç«¯**: Next.js 14 + TypeScript + Tailwind CSS
- **è®¤è¯**: NextAuth.js
- **æ•°æ®å­˜å‚¨**: Vercel KV (Redis)
- **æ–‡ä»¶å­˜å‚¨**: Vercel Blob
- **AI æœåŠ¡**: OpenAI GPT-4 Vision API
- **è¿åŠ¨æ•°æ®**: Garmin Connect API

## ğŸš€ éƒ¨ç½²æ–¹æ¡ˆï¼ˆæ¨èï¼šVercelï¼‰

### 1. å‡†å¤‡å·¥ä½œ

#### 1.1 ä»£ç å‡†å¤‡
```bash
# ç¡®ä¿é¡¹ç›®æ„å»ºæˆåŠŸ
cd zhiji-app
npm install
npm run build
npm run type-check
```

#### 1.2 Git ä»“åº“
```bash
# åˆå§‹åŒ– Git ä»“åº“ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
git init
git add .
git commit -m "Initial commit"

# æ¨é€åˆ° GitHub/GitLab
git remote add origin <your-repo-url>
git push -u origin main
```

### 2. Vercel éƒ¨ç½²æ­¥éª¤

#### 2.1 è¿æ¥ Vercel
1. è®¿é—® [vercel.com](https://vercel.com)
2. ä½¿ç”¨ GitHub/GitLab è´¦æˆ·ç™»å½•
3. ç‚¹å‡» "New Project"
4. é€‰æ‹©ä½ çš„ `zhiji-app` ä»“åº“
5. é…ç½®é¡¹ç›®è®¾ç½®ï¼š
   - **Framework Preset**: Next.js
   - **Root Directory**: `./` (å¦‚æœé¡¹ç›®åœ¨æ ¹ç›®å½•)
   - **Build Command**: `npm run build`
   - **Output Directory**: `.next`

#### 2.2 ç¯å¢ƒå˜é‡é…ç½®
åœ¨ Vercel é¡¹ç›®è®¾ç½®ä¸­æ·»åŠ ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

```env
# NextAuth é…ç½®
NEXTAUTH_URL=https://your-domain.vercel.app
NEXTAUTH_SECRET=your-super-secret-key-here

# Vercel KV (Redis) - è‡ªåŠ¨é…ç½®
KV_REST_API_URL=<vercel-kv-url>
KV_REST_API_TOKEN=<vercel-kv-token>

# OpenAI API
OPENAI_API_KEY=sk-your-openai-api-key

# Garmin Connect (å¯é€‰)
GARMIN_USERNAME=your-garmin-username
GARMIN_PASSWORD=your-garmin-password
```

## ğŸ”§ ç¯å¢ƒå˜é‡è¯¦ç»†é…ç½®

### 3.1 å¿…éœ€ç¯å¢ƒå˜é‡

| å˜é‡å | æè¿° | è·å–æ–¹å¼ |
|--------|------|----------|
| `NEXTAUTH_URL` | åº”ç”¨çš„å®Œæ•´ URL | éƒ¨ç½²åçš„åŸŸå |
| `NEXTAUTH_SECRET` | NextAuth åŠ å¯†å¯†é’¥ | ç”Ÿæˆéšæœºå­—ç¬¦ä¸² |
| `OPENAI_API_KEY` | OpenAI API å¯†é’¥ | OpenAI å®˜ç½‘ç”³è¯· |

### 3.2 Vercel KV é…ç½®

1. åœ¨ Vercel é¡¹ç›®ä¸­ï¼š
   - è¿›å…¥ "Storage" æ ‡ç­¾
   - ç‚¹å‡» "Create Database"
   - é€‰æ‹© "KV (Redis)"
   - åˆ›å»ºæ•°æ®åº“
   - ç¯å¢ƒå˜é‡ä¼šè‡ªåŠ¨æ·»åŠ 

### 3.3 ç”Ÿæˆ NEXTAUTH_SECRET

```bash
# æ–¹æ³• 1: ä½¿ç”¨ OpenSSL
openssl rand -base64 32

# æ–¹æ³• 2: ä½¿ç”¨ Node.js
node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"

# æ–¹æ³• 3: åœ¨çº¿ç”Ÿæˆ
# è®¿é—® https://generate-secret.vercel.app/32
```

## ğŸŒ åŸŸåé…ç½®

### 4.1 è‡ªå®šä¹‰åŸŸåï¼ˆå¯é€‰ï¼‰

1. åœ¨ Vercel é¡¹ç›®è®¾ç½®ä¸­ï¼š
   - è¿›å…¥ "Domains" æ ‡ç­¾
   - æ·»åŠ è‡ªå®šä¹‰åŸŸå
   - é…ç½® DNS è®°å½•

2. DNS é…ç½®ç¤ºä¾‹ï¼š
```
Type: CNAME
Name: www
Value: cname.vercel-dns.com

Type: A
Name: @
Value: 76.76.19.19
```

### 4.2 SSL è¯ä¹¦
- Vercel è‡ªåŠ¨æä¾› SSL è¯ä¹¦
- æ”¯æŒè‡ªåŠ¨ç»­æœŸ
- æ— éœ€é¢å¤–é…ç½®

## ğŸ—„ï¸ æ•°æ®åº“è®¾ç½®

### 5.1 Vercel KV è®¾ç½®

Vercel KV æ˜¯åŸºäº Redis çš„æ‰˜ç®¡æ•°æ®åº“æœåŠ¡ï¼š

1. **è‡ªåŠ¨é…ç½®**: åˆ›å»ºåç¯å¢ƒå˜é‡è‡ªåŠ¨æ³¨å…¥
2. **æ•°æ®æŒä¹…åŒ–**: è‡ªåŠ¨å¤‡ä»½å’Œæ¢å¤
3. **å…¨çƒåˆ†å¸ƒ**: è¾¹ç¼˜ç½‘ç»œä¼˜åŒ–
4. **å…è´¹é¢åº¦**: 
   - 30,000 æ¬¡è¯·æ±‚/æœˆ
   - 256MB å­˜å‚¨ç©ºé—´

### 5.2 æ•°æ®ç»“æ„

åº”ç”¨ä½¿ç”¨ä»¥ä¸‹ Redis æ•°æ®ç»“æ„ï¼š

```typescript
// ç”¨æˆ·è®¤è¯
auth:email:{email} -> ç”¨æˆ·ä¿¡æ¯å“ˆå¸Œ
auth:session:{sessionId} -> ä¼šè¯ä¿¡æ¯

// ç”¨æˆ·æ•°æ®
user:{userId}:profile -> ç”¨æˆ·èµ„æ–™
user:{userId}:foods -> é£Ÿç‰©è®°å½•åˆ—è¡¨
user:{userId}:garmin -> Garmin æ•°æ®

// é£Ÿç‰©è®°å½•
food:{foodId} -> é£Ÿç‰©è¯¦ç»†ä¿¡æ¯

// æ¯æ—¥æ±‡æ€»
daily:{userId}:{date} -> æ¯æ—¥è¥å…»æ±‡æ€»
```

## ğŸ”Œ ç¬¬ä¸‰æ–¹æœåŠ¡é…ç½®

### 6.1 OpenAI API é…ç½®

1. **è·å– API Key**:
   - è®¿é—® [platform.openai.com](https://platform.openai.com)
   - æ³¨å†Œ/ç™»å½•è´¦æˆ·
   - åˆ›å»º API Key
   - è®¾ç½®ä½¿ç”¨é™åˆ¶å’Œé¢„ç®—

2. **æ¨¡å‹é€‰æ‹©**:
   - æ¨èä½¿ç”¨ `gpt-4-vision-preview`
   - æ”¯æŒå›¾åƒåˆ†æåŠŸèƒ½
   - æˆæœ¬çº¦ $0.01-0.03/æ¬¡åˆ†æ

3. **å®‰å…¨è®¾ç½®**:
   - è®¾ç½® API Key ä½¿ç”¨é™åˆ¶
   - ç›‘æ§ä½¿ç”¨é‡å’Œæˆæœ¬
   - å®šæœŸè½®æ¢ API Key

### 6.2 Garmin Connect API

1. **è´¦æˆ·å‡†å¤‡**:
   - éœ€è¦æœ‰æ•ˆçš„ Garmin Connect è´¦æˆ·
   - ç¡®ä¿æœ‰è¿åŠ¨æ•°æ®è®°å½•

2. **é…ç½®è¯´æ˜**:
   - ä½¿ç”¨ç”¨æˆ·å/å¯†ç è®¤è¯
   - æ”¯æŒè‡ªåŠ¨æ•°æ®åŒæ­¥
   - å¯é€‰åŠŸèƒ½ï¼Œä¸å½±å“æ ¸å¿ƒåŠŸèƒ½

## âœ… éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

### 7.1 ä»£ç æ£€æŸ¥
- [ ] æ‰€æœ‰ TypeScript é”™è¯¯å·²ä¿®å¤
- [ ] æ„å»ºæˆåŠŸ (`npm run build`)
- [ ] ç±»å‹æ£€æŸ¥é€šè¿‡ (`npm run type-check`)
- [ ] ESLint æ£€æŸ¥é€šè¿‡ (`npm run lint`)

### 7.2 ç¯å¢ƒå˜é‡æ£€æŸ¥
- [ ] `NEXTAUTH_URL` è®¾ç½®ä¸ºæ­£ç¡®çš„åŸŸå
- [ ] `NEXTAUTH_SECRET` å·²ç”Ÿæˆå¹¶è®¾ç½®
- [ ] `OPENAI_API_KEY` å·²é…ç½®ä¸”æœ‰æ•ˆ
- [ ] Vercel KV æ•°æ®åº“å·²åˆ›å»º

### 7.3 åŠŸèƒ½æµ‹è¯•
- [ ] ç”¨æˆ·æ³¨å†Œ/ç™»å½•åŠŸèƒ½æ­£å¸¸
- [ ] AI é£Ÿç‰©åˆ†æåŠŸèƒ½æ­£å¸¸
- [ ] æ•°æ®å­˜å‚¨å’Œè¯»å–æ­£å¸¸
- [ ] å“åº”å¼è®¾è®¡åœ¨ç§»åŠ¨ç«¯æ­£å¸¸

## ğŸš¨ å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ

### 8.1 éƒ¨ç½²å¤±è´¥

**é—®é¢˜**: æ„å»ºå¤±è´¥
```bash
Error: Type error: Cannot find module '@/lib/storage'
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥ tsconfig.json è·¯å¾„é…ç½®
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    }
  }
}
```

### 8.2 ç¯å¢ƒå˜é‡é—®é¢˜

**é—®é¢˜**: KV_REST_API_URL æœªå®šä¹‰
```
Failed to parse URL from your_kv_rest_api_url
```

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®ä¿ Vercel KV æ•°æ®åº“å·²åˆ›å»º
2. é‡æ–°éƒ¨ç½²é¡¹ç›®ä»¥è·å–æœ€æ–°ç¯å¢ƒå˜é‡
3. æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®æ³¨å…¥

### 8.3 NextAuth é…ç½®é—®é¢˜

**é—®é¢˜**: ç™»å½•é‡å®šå‘å¤±è´¥
```
[next-auth][error][SIGNIN_EMAIL_ERROR]
```

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ `NEXTAUTH_URL` æ˜¯å¦æ­£ç¡®
2. ç¡®ä¿ `NEXTAUTH_SECRET` å·²è®¾ç½®
3. éªŒè¯åŸŸåé…ç½®

### 8.4 OpenAI API é—®é¢˜

**é—®é¢˜**: API è°ƒç”¨å¤±è´¥
```
Error: OpenAI API key not configured
```

**è§£å†³æ–¹æ¡ˆ**:
1. éªŒè¯ API Key æ ¼å¼ (sk-...)
2. æ£€æŸ¥ API Key æƒé™å’Œä½™é¢
3. ç¡®è®¤æ¨¡å‹å¯ç”¨æ€§

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### 9.1 Vercel Analytics

å¯ç”¨ Vercel Analytics ç›‘æ§ï¼š
1. åœ¨é¡¹ç›®è®¾ç½®ä¸­å¯ç”¨ Analytics
2. ç›‘æ§é¡µé¢æ€§èƒ½å’Œç”¨æˆ·è¡Œä¸º
3. æŸ¥çœ‹é”™è¯¯æ—¥å¿—å’Œå´©æºƒæŠ¥å‘Š

### 9.2 æˆæœ¬ç›‘æ§

**Vercel å…è´¹é¢åº¦**:
- 100GB å¸¦å®½/æœˆ
- 100 æ¬¡éƒ¨ç½²/å¤©
- æ— é™é™æ€ç½‘ç«™

**ä»˜è´¹åŠŸèƒ½**:
- Vercel KV: $0.25/100K è¯·æ±‚
- Vercel Blob: $0.15/GB å­˜å‚¨
- å‡½æ•°æ‰§è¡Œæ—¶é—´è¶…é™

### 9.3 æ€§èƒ½ä¼˜åŒ–

1. **å›¾ç‰‡ä¼˜åŒ–**:
   - ä½¿ç”¨ Next.js Image ç»„ä»¶
   - å¯ç”¨ WebP æ ¼å¼
   - é…ç½®é€‚å½“çš„ç¼“å­˜ç­–ç•¥

2. **ä»£ç åˆ†å‰²**:
   - ä½¿ç”¨åŠ¨æ€å¯¼å…¥
   - ä¼˜åŒ–åŒ…å¤§å°
   - å¯ç”¨ Tree Shaking

3. **ç¼“å­˜ç­–ç•¥**:
   - é…ç½® Redis ç¼“å­˜
   - ä½¿ç”¨ SWR è¿›è¡Œæ•°æ®è·å–
   - å¯ç”¨ CDN ç¼“å­˜

### 9.4 å®‰å…¨ç»´æŠ¤

1. **å®šæœŸæ›´æ–°**:
   - æ›´æ–°ä¾èµ–åŒ…ç‰ˆæœ¬
   - ä¿®å¤å®‰å…¨æ¼æ´
   - è½®æ¢ API Keys

2. **è®¿é—®æ§åˆ¶**:
   - å®æ–½é€Ÿç‡é™åˆ¶
   - æ·»åŠ  CORS é…ç½®
   - ç›‘æ§å¼‚å¸¸è®¿é—®

## ğŸ”„ æ›´æ–°å’Œå›æ»š

### 10.1 è‡ªåŠ¨éƒ¨ç½²

Vercel æ”¯æŒ Git é›†æˆè‡ªåŠ¨éƒ¨ç½²ï¼š
- æ¨é€åˆ° `main` åˆ†æ”¯è‡ªåŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
- æ¨é€åˆ°å…¶ä»–åˆ†æ”¯åˆ›å»ºé¢„è§ˆéƒ¨ç½²
- æ”¯æŒéƒ¨ç½²é’©å­å’Œé€šçŸ¥

### 10.2 å›æ»šç­–ç•¥

```bash
# é€šè¿‡ Vercel CLI å›æ»š
vercel --prod --rollback

# æˆ–åœ¨ Vercel Dashboard ä¸­é€‰æ‹©å†å²éƒ¨ç½²è¿›è¡Œå›æ»š
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°éƒ¨ç½²é—®é¢˜ï¼Œå¯ä»¥ï¼š

1. **æŸ¥çœ‹æ—¥å¿—**: Vercel Dashboard > Functions æ ‡ç­¾
2. **ç¤¾åŒºæ”¯æŒ**: Vercel Discord ç¤¾åŒº
3. **æ–‡æ¡£å‚è€ƒ**: [vercel.com/docs](https://vercel.com/docs)
4. **GitHub Issues**: é¡¹ç›®ä»“åº“æäº¤é—®é¢˜

---

## ğŸ‰ éƒ¨ç½²å®Œæˆ

æ­å–œï¼æ‚¨çš„è„‚è®°åº”ç”¨å·²æˆåŠŸéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚

**ä¸‹ä¸€æ­¥**:
1. æµ‹è¯•æ‰€æœ‰åŠŸèƒ½æ˜¯å¦æ­£å¸¸
2. é…ç½®ç›‘æ§å’Œå‘Šè­¦
3. å‡†å¤‡ç”¨æˆ·æ–‡æ¡£å’Œä½¿ç”¨æŒ‡å—
4. è€ƒè™‘ SEO ä¼˜åŒ–å’Œæ€§èƒ½è°ƒä¼˜

**è®¿é—®åœ°å€**: https://your-domain.vercel.app

ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼ğŸŠ